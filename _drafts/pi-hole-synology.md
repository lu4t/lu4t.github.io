---
layout: post
title: pihole en la NAS.
subtitle: internet sin anuncios.
cover-img: /assets/img/path.jpg
tags: [Synology]
---

¿Qué es pi-hole?, básicamente es un servicio de red bloqueador de anuncios, dando servicio de resolución de nombres (DNS) e incluso de asignación de IPs (DHCP) a todos los dispositivos que están conectados a una red doméstica. 
Y ¿cómo lo hace?: funciona como un DNS local que intercepta las peticiones a DNS que hacen los dispositivos conectados a tu red, y comprueba si están incluídos en unas listas de sitios conocidos y que se dedican a servir anuncios. 

La instalación de pi-hole como un docker sobre una NAS Synology tiene varios pasos, y los vamos a comentar en este post. Ya hay multitud de videos en youtube que cubren cómo configurar una pi-hole una vez instalada, así que nos vamos a centrar en las particularidades que tiene la configuración de una pi-hole para que arranque como un docker en una Synology. En gran medida, tenemos que lidiar con el hecho de que una Synology tiene muchos servicios arrancados "de serie", y por tanto la probabilidad de que haya un conflicto de puertos es alta; esto hace que parezca más dificil instalar una pi-hole en una Synology, que en una Raspberry. Pero si tomais las precauciones que os explico a continuación, vereis que no hay ningún problema.

El objetivo que queremos conseguir es hacer que la pi-hole corra en un docker con una IP propia, que sea accesible desde cualquier equipo pinchado a mi red (incluído el Host Docker, la propia Synology); es decir, que la pi-hole tiene que tener su propia IP dentro del rango de direcciones locales... Lo que vulgarmente conocemos como el rango: 192.168.1.XXX y además su dirección debe ser distinta a la de la Synology que hace de Host.

Para que no te pierdas durante el post: vamos a suponer que la IP de la Synology es la 192.168.1.14, y que hemos decidido que la pi-hole va a tener la 192.168.1.30 Esto, lógicamente, son dos ejemplos. Tú puedes decidir las IPs que en tu red. Sólo asegurate de que no estén ya asignadas, o que no están el el rango asignable por DHCP.

Lo primero que hacemos es iniciar sesión en nuestra NAS, y vamos a la carpeta donde se guardan los archivos persistentes de los dockers. Normalmente, en una Synology, la ruta es /volume1/docker/
Creamos en ella la carpeta persistente de la pi-hole: 'mkdir pi-hole'


y dentro de ella dos carpetas
En esa carpeta, generamos dos carpetas: 
pi-hole


 una se llamará TC - hole y la siguiente se llamará TC - d NS mas q dot d, verifiquemos qué tenemos hacer que esas dos carpetas se creen a continuación, lo que tenemos que hacer es crear un controlador de red virtual Mac villain lo que este controlador nos permitirá o lo que esta interfaz de red dentro del docker nos permitirá nos permitirá usar diferentes direcciones IP para nuestro a continuación, lo que normalmente haríamos, por ejemplo, si solo creara un acoplador y lo configurara como host usado, entonces, por supuesto, estará en la misma dirección IP que Synology y si lo hiciéramos, tendríamos un conflicto de puertos entre los puertos que Synology los usos y los puertos que el agujero debe funcionar, por lo que para crear un nuevo puerto, lo que tenemos que hacer es lo siguiente que tenemos que hacer es escribir IP addr para obtener la lista de todos después de la red o la red puertos que Synology tiene bien, esta es una lista larga. Los he acoplado, por lo que está acoplado. Dakka Dakka Dakka Dakka ethernet 3 internet 0 esta es mi dirección de Synology, así que estoy usando el número de puerto 3, se llama patrón eth0 en 0 tengo que recordar esto porque ahora lo usaremos en nuestra red LAN macro que creará, borremos esto y comencemos a escribir el comando para que sea sudo docker network, así que el superusuario docker dock Network create, así crearemos su red D y usaremos controlador Mac a través de LAN Lo siguiente que tenemos que hacer es definir nuestra subred, así que anteriormente hemos visto que mi subred es 1 y dos punto uno sesenta y ocho punto uno punto X, así que mi subred es 19216810 y estoy usando todo el rango lo siguiente que tenemos que hacer es definir el rango I lo que seremos usando así que es un rango de IP hay un par de opciones, una opción es lo que usaré aquí es usar - 32 esto limitará el rango a solo una dirección IP Solo necesito una dirección IP en este rango y esta dirección se usará por ejemplo, puede usar: 30 para obtener, creo que la dirección es 24, le da un rango completo, pero comienza desde 0, por lo que depende de la cantidad de direcciones IP que necesite, pero para este agujero de pastel solo necesitará una, por lo que es 1 9 2 1 6 estado 1 1 99 esta es la dirección que usaré y - 32 esta dirección que usaré y solo deshabilitaré - lo siguiente que tenemos que definir es nuestra puerta de enlace este Network Gator típico que estás usando dentro de tu red y generalmente esto es 192 168 1 1 para mí Tengo dos puertas de enlace y no uso una, pero para la prueba, digamos que este es su enrutador ISP estándar. Lo siguiente que tenemos que hacer es definir el adaptador de red principal. así que el adaptador de red principal es lo que hemos visto anteriormente en mi caso Ethernet 0 esto es para mi prueba en entorno en mi entorno de entorno de producción este es el enlace 0 Creo que porque estoy usando una conexión de enlace para combinar dos puertos Ethernet en uno y lo último que queremos hacer es que queremos nombrar esta red, podría llamarse pi-hole y ese es nuestro la red se creó bien, ahora podemos volver a nuestra Synology y en Synology veamos en la red acoplable ahora tenemos una nueva red sin contenedores conectados, por lo que PI toda la red está vacía. Lo siguiente que tenemos que hacer es crear una red adicional y haremos esto a la ventana acoplable y terminemos de instalar PI completo - doctor - está bien, así que agreguemos, usemos la configuración manual, crearemos una subred completamente nueva. en dos uno seis ocho dos cero y usaremos toda la subred entera. Lo siguiente que tenemos que hacer es definir el rango, así que para mí será uno nueve dos uno seis ocho dos dos y solo usaremos uno. habla a y queremos definir ahora la puerta donde para esta subred o para este puente y esto será, por supuesto, la dirección uno y dos uno seis ocho dos uno más o menos, es solo presionamos agregar y el puente debe crearse en un par de segundos bien, entonces tenemos el puente completo de pi y la red completa de pi, así que vamos al registro, escriba por hoyo, esta es la imagen que queremos usar, presione descargar, así que ahora tenemos una nueva imagen que aún no se ha descargado [Música] y ahora está el agujero descargado, iniciemos, lo llamaremos pi-hole, no necesitamos usar privilegios altos, a menos que esté usando pi-hole también como su servidor DHCP, así que dejemos esto sin confirmar por ahora vamos a la configuración avanzada, habilitaremos el volumen de inicio automático que tenemos que creamos un par de volúmenes que anteriormente creamos dos carpetas, así que ahora agreguemos esas dos carpetas también aquí, uno será docker pi-hole y máscara DNS y montaremos esta carpeta con el e TC d TC - DNS máscara dot d y ahora también agregaremos otra carpeta acoplador por agujero y este pliegue er conecte con ATC por hoyo. A continuación, lo que tenemos que hacer es agregar redes, así que elegiremos por toda la red y elegiremos por toda la red de puente y eliminaremos la red de puente, esas son las dos redes que creamos anteriormente, una es PI La red nos permite usar una dirección IP estándar que es diferente de Synology y la red de puente se usará para conectar Synology con la configuración de puerto de pie que podemos dejar tal como la estamos usando ahora o usaremos una dirección IP diferente a la que conocemos en C el entorno dejemos todo como está, pero agreguemos un par de variables antes que nada, lo que debemos hacer es agregar una máscara DNS escuchando el NS preguntar, por favor, vinculado a lo local, lo que nos permite escuchar este desastre DNS nos permite usar o escuchar a redes y puentes internos y externos, por lo que cubrimos todas nuestras redes para la funcionalidad de taladro. Lo siguiente que tenemos que hacer es definir la zona horaria y, por supuesto, mi zona horaria es Europa Zagreb. Lo siguiente que pondré aquí es que estará bien aquí mi contraseña porque es mucho más fácil hacerlo desde aquí que navegar a través de los archivos de registro y ver qué contraseña se generó, así que escriba la contraseña web y la pondré aquí una contraseña aleatoria pero, por supuesto, trataré de recordarla una cosa, no estoy seguro de si es necesaria o no, pero se llama host virtual y host virtual variable de salida aquí host virtual y nuestro agujero llamado vamos a verificar si todo está bien, está bien aquí tenemos dos valores correctos y escribe nuestro valor plateado es 192 168 1 199 si recuerdas que esta es la dirección IP que reservamos para nuestro villano de Mac, bien, apliquemos este clic y luego, vamos a mostrar el contenedor, se ve más o menos bien, está bien Antes de continuar con los pasos finales de la instalación, verifiquemos y asegurémonos de que todo funcione bien, para eso iremos al retenedor y adentro fingiremos que iremos a los contenedores y iremos al asistente de casa iremos a la consola escriba aquí root como nombre de usuario e intentemos primero con rosa la dirección IP de nuestro dispositivo Synology está funcionando bien, luego intentaremos con la dirección IP rosa en todo el servidor PI no está funcionando y luego intentemos hacer ping a la IP del puente completo PI la dirección está funcionando, así que como pueden ver, esta es la razón por la que creamos este puente adicional para que podamos comunicarnos entre el asistente doméstico y el servidor completo. Hagamos un paso más, vamos a ponerlo y veamos cómo funciona nuestro servidor Synology. ve por todo el alma bien rosa lo siento, tenemos que escribir primero sulu pink 1 y 2 1 6 8 1 1 9 y nada ahora intentemos hacer ping 1 9 2 1 6 8 2 2 lo siento olvidé el rosa y está funcionando esta es la razón por la cual tenemos que configurar en nuestra Synology que queremos usar esta dirección IP recién creada Dirección IP del puente como nuestra puerta de enlace para hacer eso, volvamos a la sinergia en Synology vamos al panel de control Red y aquí configuraremos eso será usando el servidor DNS preferido - hacemos clic en aplicar un y esto debería ser para su configuración de Synology y esto también incluye la configuración del asistente de inicio y el último paso ahora, ya que ha cambiado su configuración de IP, se recomienda que reinicie su servidor, por lo que debe reiniciar y le tomará alrededor de cinco a diez minutos para que su servidor vuelva a estar en marcha, cerremos esto y volvamos al asistente de inicio en el asistente de inicio, vamos al configurador, avancemos al final del archivo y al final del archivo escribimos Tengo dos espacios host 1 & 2 1 6 8 2 2 esta es la dirección IP de nuestro puente de conexión y escribimos también como celda falsa guardar esto ir a la configuración de control del servidor verificar la configuración y reiniciar nuestro servidor nuestro servidor está de nuevo en línea vamos a la descripción general y ya creó un agujero de tarta allí un par y ya está aquí, así que lo leí palpable un sensor para el porcentaje de anuncios bloqueados de anuncios de anuncios y para efectivo y reenviarlo también hay dos bloques de anuncios gráficos y consultas DNS en caché como puede ver Todavía las entidades no están disponibles y eso es normal. Tardan cinco minutos para que los datos del agujero lleguen al asistente de inicio. Agitemos cinco minutos y, después de aproximadamente cinco minutos, los datos han comenzado a llegar al asistente de inicio. solución alternativa con respecto a la red y todo lo que pueda experimentar problemas para instalarlo desafortunadamente, este no es un sistema a prueba de balas, especialmente si tiene algún tipo de configuración de red un poco diferente o cualquier tipo de enrutamiento especial o servicios DNS dentro de su red debido a eso también grabe episodios adicionales de instalación de agujeros en la ventana acoplable donde usaré el reenvío de puertos y mantendremos nuestra dirección IP de Synology y antes de irnos, verifiquemos cómo se ve el agujero de pastel dentro del navegador web, solo tiene que escribir la dirección de el servidor de taladro y cuando tocas tu dirección para mí este es 1 y 2 1 6 8 1 1 9 9 obtendrás esta interfaz de usuario vamos a admi n panel, este es un panel de administración de usuarios no conectado aquí, puede ver todas las solicitudes que recibió el servidor DNS, iniciemos sesión ahora, ingresemos nuestra contraseña y aquí tenemos información detallada sobre dominios de consultas, etc., por supuesto, puede jugar con las otras configuraciones, por ejemplo, elija diferentes servidores ascendentes DNS, seleccione direcciones IP personalizadas para servidores DNS, etc., pero esto es todo por hoy. Espero que haya disfrutado este episodio si tiene algún tipo de comentario o pregunta, déjelo en una sección de comentarios si aún no se ha suscrito, suscríbase, presione el botón de la campana para recibir notificaciones en las futuras actualizaciones si le gustó este video, denme un visto bueno y lo veré en siete días donde instalaremos Edgard Home Edition también dentro de la ventana acoplable muchas gracias por mirar hasta la próxima vez adiós y diviértete